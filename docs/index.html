<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Treatment Effects Tools • ptetools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Panel Treatment Effects Tools">
<meta property="og:description" content="This is fairly generic code for estimating treatment effects with panel data. This is useful code in my own work and will perhaps be useful to others. It builds heavily on the \code{did} package. In particular, it breaks into separate steps organizing the data, looping over groups and time periods, computing group-time average treatment effects, and aggregating group-time average treatment effects. Often, one is able to implement a new identification/estimation procedure by simply replacing the step on estimating group-time average treatment effects. See several different examples of this approach in the README.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ptetools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bcallaway11/pte/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="panel-treatment-effects-tools-ptetools-package-">Panel Treatment Effects Tools (ptetools) Package <img src="reference/figures/logo.png" align="right" alt="ptetools" width="155"><a class="anchor" aria-label="anchor" href="#panel-treatment-effects-tools-ptetools-package-"></a>
</h1></div>
<p>The <code>ptetools</code> package compartmentalizes the steps needed to implement estimators of group-time average treatment effects (and their aggregations) in order to make it easier to apply the same sorts of arguments outside of their “birthplace” in the literature on difference-in-differences.</p>
<p>This code is lightweight, only works for balanced panels, and has minimal error checking. That said, it should be useful projects that build on top of group-time average treatment effects in order to deliver estimates of causal effects in panel data settings.</p>
<p>The main function is called <code>pte</code>. The most important paramters that it takes in are <code>subset_fun</code> and <code>attgt_fun</code>. These are functions that the user should pass to <code>pte</code>.</p>
<p><code>subset_fun</code> takes in the overall data, a group, a time period, and possibly other arguments and returns a <code>data.frame</code> containing the relevant subset of the data, an outcome, and whether or not a unit should be considered to be in the treated or comparison group for that group/time. There is one example of a relevant subset function provided in the package: <a href="https://github.com/bcallaway11/ptetools/blob/master/R/subset_functions.R" class="external-link">the <code>two_by_two_subset</code> function</a>. This function takes an original dataset, subsets it into pre- and post-treatment periods and denotes treated and untreated units. This particular subset is perhaps the most common/important one for thinking about treatment effects with panel data.</p>
<p>The other main function is <code>attgt_fun</code>. This function should be able to take in the correct subset of data, possibly along with other arguments to the function, and report an <em>ATT</em> for that subset. With minor modification, this function should be availble for most any sort of treatment effects application — for example, if you can solve the baseline 2x2 case in difference in differences, you should use that function here, and the <code>ptetools</code> package will take care of dealing with the variation in treatment timing.</p>
<p>If <code>attgt_fun</code> returns an influence function, then the <code>ptetools</code> package will also conduct inference using the multiplier bootstrap (which is fast) and produce uniform confidence bands (which adjust for multiple testing).</p>
<p>The default output of <code>pte</code> is an overall treatment effect on the treated (i.e., across all groups that participate in the treatment in any time period) and dynamic effects (i.e., event studies). More aggregations are possible, but these seem to be the leading cases; aggregations of group-time average treatment effects are discussed at length in <a href="https://doi.org/10.1016/j.jeconom.2020.12.001" class="external-link">Callaway and Sant’Anna (2021)</a>.</p>
<p>Here are a few examples:</p>
<div class="section level2">
<h2 id="example-1-difference-in-differences">Example 1: Difference in differences<a class="anchor" aria-label="anchor" href="#example-1-difference-in-differences"></a>
</h2>
<p>The <a href="https://bcallaway11.github.io/did/" class="external-link"><code>did</code> package</a>, which is based on <a href="https://doi.org/10.1016/j.jeconom.2020.12.001" class="external-link">Callaway and Sant’Anna (2021)</a>, includes estimates of group-time average treatment effects, <em>ATT(g,t)</em>, based on a difference in differences identification strategy. The following example demonstrates that it is easy to compute group-time average treatment effects using difference in differences using the <code>ptetools</code> package. [<em>Note:</em> This is definitely not the recommended way of doing this as there is very little error handling, etc. here, but it is rather a proof of concept. You should use the <code>did</code> package for this case.]</p>
<p>This example reproduces DID estimates of the effect of the minimum wage on employment using data from the <code>did</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bcallaway11.github.io/did/" class="external-link">did</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">)</span></span>
<span><span class="va">did_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pte.html">pte</a></span><span class="op">(</span></span>
<span>  yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>  gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>  tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>  setup_pte_fun <span class="op">=</span> <span class="va">setup_pte</span>,</span>
<span>  subset_fun <span class="op">=</span> <span class="va">two_by_two_subset</span>,</span>
<span>  attgt_fun <span class="op">=</span> <span class="va">did_attgt</span>,</span>
<span>  xformla <span class="op">=</span> <span class="op">~</span><span class="va">lpop</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in pte(yname = "lemp", gname = "first.treat", tname = "year", idname = "countyreal", : 'pte' is deprecated.</span></span>
<span><span class="co">#&gt; Use 'pte2' instead.</span></span>
<span><span class="co">#&gt; See help("Deprecated")</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">did_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ATT:  </span></span>
<span><span class="co">#&gt;      ATT    Std. Error     [ 95%  Conf. Int.]  </span></span>
<span><span class="co">#&gt;  -0.0323        0.0135    -0.0587     -0.0058 *</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dynamic Effects:</span></span>
<span><span class="co">#&gt;  Event Time Estimate Std. Error   [95%  Conf. Band]  </span></span>
<span><span class="co">#&gt;          -3   0.0269     0.0112 -0.0053      0.0591  </span></span>
<span><span class="co">#&gt;          -2  -0.0050     0.0126 -0.0413      0.0313  </span></span>
<span><span class="co">#&gt;          -1  -0.0229     0.0124 -0.0584      0.0127  </span></span>
<span><span class="co">#&gt;           0  -0.0201     0.0139 -0.0602      0.0199  </span></span>
<span><span class="co">#&gt;           1  -0.0547     0.0173 -0.1046     -0.0049 *</span></span>
<span><span class="co">#&gt;           2  -0.1382     0.0337 -0.2350     -0.0414 *</span></span>
<span><span class="co">#&gt;           3  -0.1069     0.0340 -0.2046     -0.0092 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: `*' confidence band does not cover 0</span></span>
<span><span class="fu"><a href="reference/ggpte.html">ggpte</a></span><span class="op">(</span><span class="va">did_res</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png"><!-- --></p>
<p>What’s most interesting here, is that the only “new” code that needs to be writte is in <a href="https://github.com/bcallaway11/ptetools/blob/master/R/attgt_functions.R" class="external-link">the <code>did_attgt</code> function</a>. You will see that this is a very small amount of code.</p>
</div>
<div class="section level2">
<h2 id="example-2-policy-evaluation-during-a-pandemic">Example 2: Policy Evaluation during a Pandemic<a class="anchor" aria-label="anchor" href="#example-2-policy-evaluation-during-a-pandemic"></a>
</h2>
<p>As a next example, consider trying to estimate effects of Covid-19 related policies during a pandemic. The estimates below are for the effects of state-leve shelter-in-place orders during the early part of the pandemic.</p>
<p><a href="https://arxiv.org/abs/2105.06927" class="external-link">Callaway and Li (2021)</a> argue that a particular unconfoundedness-type strategy is more appropriate in this context than DID-type strategies due to the spread of Covid-19 cases being highly nonlinear. However, they still deal with the challenge of variation in treatment timing. Therefore, it is still useful to think about group-time average treatment effects, but the DID strategy should be replaced with their particular unconfoundedness type assumption.</p>
<p>The <code>ptetools</code> package is particularly useful here.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># formula for covariates</span></span>
<span><span class="va">xformla</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">current</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">current</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">region</span> <span class="op">+</span> <span class="va">totalTestResults</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pte.html">pte</a></span><span class="op">(</span></span>
<span>  yname <span class="op">=</span> <span class="st">"positive"</span>,</span>
<span>  gname <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  tname <span class="op">=</span> <span class="st">"time.period"</span>,</span>
<span>  idname <span class="op">=</span> <span class="st">"state_id"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">covid_data2</span>,</span>
<span>  setup_pte_fun <span class="op">=</span> <span class="va">setup_pte_basic</span>,</span>
<span>  subset_fun <span class="op">=</span> <span class="va">two_by_two_subset</span>,</span>
<span>  attgt_fun <span class="op">=</span> <span class="va">covid_attgt</span>,</span>
<span>  xformla <span class="op">=</span> <span class="va">xformla</span>,</span>
<span>  max_e <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  min_e <span class="op">=</span> <span class="op">-</span><span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in pte(yname = "positive", gname = "group", tname = "time.period", : 'pte' is deprecated.</span></span>
<span><span class="co">#&gt; Use 'pte2' instead.</span></span>
<span><span class="co">#&gt; See help("Deprecated")</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span><span class="co">#&gt; Warning in mboot2(thisinffunc, biters = biters, alp = alp): critical value for uniform confidence band is somehow smaller than</span></span>
<span><span class="co">#&gt;             critical value for pointwise confidence interval...using pointwise</span></span>
<span><span class="co">#&gt;             confidence interal</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">covid_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ATT:  </span></span>
<span><span class="co">#&gt;      ATT    Std. Error     [ 95%  Conf. Int.] </span></span>
<span><span class="co">#&gt;  14.8882       89.2491  -160.0369    189.8132 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dynamic Effects:</span></span>
<span><span class="co">#&gt;  Event Time Estimate Std. Error     [95%  Conf. Band]  </span></span>
<span><span class="co">#&gt;         -10  -3.7266     4.0893  -13.5376      6.0843  </span></span>
<span><span class="co">#&gt;          -9   2.6607     1.4131   -0.7295      6.0508  </span></span>
<span><span class="co">#&gt;          -8   0.8290     2.1182   -4.2528      5.9107  </span></span>
<span><span class="co">#&gt;          -7   5.2843     2.0558    0.3523     10.2164 *</span></span>
<span><span class="co">#&gt;          -6   2.8555     2.3030   -2.6698      8.3808  </span></span>
<span><span class="co">#&gt;          -5   1.3589     4.0842   -8.4397     11.1575  </span></span>
<span><span class="co">#&gt;          -4   0.3294     3.4489   -7.9451      8.6039  </span></span>
<span><span class="co">#&gt;          -3  -4.2227     4.6681  -15.4221      6.9768  </span></span>
<span><span class="co">#&gt;          -2  -3.8447     2.9548  -10.9336      3.2441  </span></span>
<span><span class="co">#&gt;          -1  -0.2234     3.4588   -8.5214      8.0747  </span></span>
<span><span class="co">#&gt;           0 -10.8156     8.4755  -31.1497      9.5184  </span></span>
<span><span class="co">#&gt;           1 -13.7998    12.9474  -44.8626     17.2630  </span></span>
<span><span class="co">#&gt;           2  -7.8432     9.9894  -31.8092     16.1228  </span></span>
<span><span class="co">#&gt;           3  -4.5541     8.6319  -25.2634     16.1552  </span></span>
<span><span class="co">#&gt;           4  -3.5368    11.3025  -30.6532     23.5795  </span></span>
<span><span class="co">#&gt;           5   8.5221    12.1537  -20.6363     37.6805  </span></span>
<span><span class="co">#&gt;           6   1.1140    17.0145  -39.7064     41.9343  </span></span>
<span><span class="co">#&gt;           7   6.6384    15.9018  -31.5122     44.7891  </span></span>
<span><span class="co">#&gt;           8   7.1288    25.9489  -55.1264     69.3840  </span></span>
<span><span class="co">#&gt;           9  10.8758    33.4554  -69.3886     91.1403  </span></span>
<span><span class="co">#&gt;          10  17.5057    30.2446  -55.0556     90.0670  </span></span>
<span><span class="co">#&gt;          11  40.8318    35.3309  -43.9323    125.5959  </span></span>
<span><span class="co">#&gt;          12  48.6134    45.3943  -60.2943    157.5210  </span></span>
<span><span class="co">#&gt;          13  52.4228    59.6057  -90.5799    195.4255  </span></span>
<span><span class="co">#&gt;          14  50.2000    55.9394  -84.0068    184.4068  </span></span>
<span><span class="co">#&gt;          15  68.2960    67.1875  -92.8965    229.4885  </span></span>
<span><span class="co">#&gt;          16  44.7305    67.4749 -117.1516    206.6126  </span></span>
<span><span class="co">#&gt;          17  61.4670    82.0294 -135.3336    258.2675  </span></span>
<span><span class="co">#&gt;          18  50.4635   104.0203 -199.0964    300.0234  </span></span>
<span><span class="co">#&gt;          19  47.3392   129.1065 -262.4062    357.0845  </span></span>
<span><span class="co">#&gt;          20  28.6326   109.0253 -232.9351    290.2003  </span></span>
<span><span class="co">#&gt;          21   4.3445   129.9741 -307.4822    316.1713  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: `*' confidence band does not cover 0</span></span>
<span><span class="fu"><a href="reference/ggpte.html">ggpte</a></span><span class="op">(</span><span class="va">covid_res</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png"><!-- --></p>
<p>What’s most interesting is just how little code needs to be written here. The only new code required is the <code>ppe::covid_attgt</code> function which is <a href="https://github.com/bcallaway11/ppe/blob/master/R/covid_attgt.R" class="external-link">available here</a>, and, as you can see, this is very simple.</p>
</div>
<div class="section level2">
<h2 id="example-3-empirical-bootstrap">Example 3: Empirical Bootstrap<a class="anchor" aria-label="anchor" href="#example-3-empirical-bootstrap"></a>
</h2>
<p>The code above used the multiplier bootstrap. The great thing about the multiplier bootstrap is that it’s fast. But in order to use it, you have to work out the influence function for the estimator of <em>ATT(g,t)</em>. Although I pretty much always end up doing this, it can be tedious, and it can be nice to get a working version of the code for a project going before working out the details on the influence function.</p>
<p>The <code>ptetools</code> package can be used with the empirical bootstrap. There are a few limitations. First, it’s going to be substantially slower. Second, this code just reports pointwise confidence intervals. However, this basically is set up to fit into my typical workflow, and I see this as a way to get preliminary results.</p>
<p>Let’s demonstrate it. To do this, consider the same setup as in Example 1, but where no influence function is returned. Let’s write the code for this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># did with no influence function</span></span>
<span><span class="va">did_attgt_noif</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gt_data</span>, <span class="va">xformla</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># call original function</span></span>
<span>  <span class="va">did_gt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/did_attgt.html">did_attgt</a></span><span class="op">(</span><span class="va">gt_data</span>, <span class="va">xformla</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># remove influence function</span></span>
<span>  <span class="va">did_gt</span><span class="op">$</span><span class="va">inf_func</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span>  <span class="va">did_gt</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, we can show the same sorts of results as above</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">did_res_noif</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pte.html">pte</a></span><span class="op">(</span></span>
<span>  yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>  gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>  tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>  setup_pte_fun <span class="op">=</span> <span class="va">setup_pte</span>,</span>
<span>  subset_fun <span class="op">=</span> <span class="va">two_by_two_subset</span>,</span>
<span>  attgt_fun <span class="op">=</span> <span class="va">did_attgt_noif</span>, <span class="co"># this is only diff.</span></span>
<span>  xformla <span class="op">=</span> <span class="op">~</span><span class="va">lpop</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in pte(yname = "lemp", gname = "first.treat", tname = "year", idname = "countyreal", : 'pte' is deprecated.</span></span>
<span><span class="co">#&gt; Use 'pte2' instead.</span></span>
<span><span class="co">#&gt; See help("Deprecated")</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">did_res_noif</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ATT:  </span></span>
<span><span class="co">#&gt;      ATT    Std. Error     [ 95%  Conf. Int.]  </span></span>
<span><span class="co">#&gt;  -0.0323        0.0125    -0.0568     -0.0077 *</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dynamic Effects:</span></span>
<span><span class="co">#&gt;  Event Time Estimate Std. Error [95% Pointwise  Conf. Band]  </span></span>
<span><span class="co">#&gt;          -3   0.0269     0.0140         -0.0005      0.0544  </span></span>
<span><span class="co">#&gt;          -2  -0.0050     0.0131         -0.0307      0.0208  </span></span>
<span><span class="co">#&gt;          -1  -0.0229     0.0155         -0.0531      0.0074  </span></span>
<span><span class="co">#&gt;           0  -0.0201     0.0123         -0.0442      0.0039  </span></span>
<span><span class="co">#&gt;           1  -0.0547     0.0170         -0.0881     -0.0214 *</span></span>
<span><span class="co">#&gt;           2  -0.1382     0.0335         -0.2039     -0.0725 *</span></span>
<span><span class="co">#&gt;           3  -0.1069     0.0344         -0.1744     -0.0394 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: `*' confidence band does not cover 0</span></span>
<span><span class="fu"><a href="reference/ggpte.html">ggpte</a></span><span class="op">(</span><span class="va">did_res_noif</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png"><!-- --></p>
<p>What’s exciting about this is just how little new code needs to be written.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/bcallaway11/pte/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ptetools</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Brantly Callaway <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Brantly Callaway.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
